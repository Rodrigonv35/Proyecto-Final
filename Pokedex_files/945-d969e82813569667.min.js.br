"use strict";
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="489103e5-1a9f-5bba-8264-82af2f6e468c")}catch(e){}}();
(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[945],{36097:(e,t,a)=>{a.d(t,{zE:()=>L,NA:()=>U,uM:()=>O});var i=a(67249),r=a(84934),n=a(11617),o=a(17333),l=a(37947),s=a(74626),d=a(88395),_=a(79940),c=a(76621),m=a(4783),u=a(3457),p=a(37870);let h=a(21898).A.createLazyComponent(()=>Promise.all([a.e(137),a.e(876),a.e(920),a.e(739),a.e(945),a.e(817)]).then(a.bind(a,28752)).then(e=>e.AutosaveNewFileAlreadyOpenModal),{loading:()=>null,error:u.H4.NONE,componentName:"AutosaveNewFileAlreadyOpenModal"}),f=(0,p.Ju)(h);var g=a(62275),w=a(74105),T=a(53297),E=a(96226),N=a(56390);let v=0;var y=a(69870),A=a(35926),I=a(9511),b=a(99506),P=a(84968),D=a(65167),F=a(874),R=a(45020),S=a(51363),M=a(84129),k=a(80820);let L=(0,k.nF)((e,{state:t,from:a,editorType:i,team:r,openNewFileIn:n,fileName:o,folderId:l,isDraftsFolder:s,callback:d,presetName:_,inFileCreationDefaultsExp:c,figjamAiNewFileData:m,figjamMakeSomethingUseCase:u})=>{var p;if(r&&!s&&("design"===i&&!(0,P.rR)(r,{type:P.sK.ADD_DESIGN_FILE})||"whiteboard"===i&&!(0,P.rR)(r,{type:P.sK.ADD_FIGJAM_FILE})||"slides"===i&&!(0,P.rR)(r,{type:P.sK.ADD_SLIDES_FILE}))){(null==(p=r.restrictions_list)?void 0:p.includes(b.P4.LOCKED))||l?e.dispatch(g.to({type:M.DV,data:{team:r,resource:F.vL.FILE,action:c?S.ZN.CREATE_FILE_FROM_DROPDOWN:S.ZN.CREATE_FILE,editorType:i,currentPlan:E.F.Plan.STARTER,upsellPlan:E.F.Plan.PRO}})):e.dispatch(g.to({type:M.DV,data:{team:r,resource:F.vL.FILE,action:S.ZN.CREATE_FILE,editorType:i,currentPlan:E.F.Plan.STARTER,upsellPlan:E.F.Plan.PRO}})),d&&d(null);return}let h=l?{folderId:l}:a!==R.f6.FILE_BROWSER_SIDEBAR_DRAFTS&&a!==R.f6.FILE_BROWSER_TEAM_FILE_LIMIT_PAYWALL&&a!==R.f6.FILE_BROWSER_TOOLBAR_RECENTS&&a!==R.f6.FILE_BROWSER_TOOLBAR_DRAFTS&&r?null:"drafts",f=(0,w.xA)(t,n,h,{from:a,selectedView:t.selectedView},i,o,d,m,u);_&&(f.framePresetName=_),e.dispatch(C(f))}),O=(0,k.nF)((e,t)=>{e.dispatch(C(t))}),U=(0,k.nF)((e,{file:t,openNewFileIn:a,source:i})=>{let n=e.getState().user;if(!n)return;let l=()=>{let n=(0,D.B)(t,a);e.dispatch(O(n)),(0,r.sx)("New Autosave File Open",{openNewFileIn:a,source:i})};o.eD?l():(0,T.M)(n.id,t).then(a=>{if(a){e.dispatch(g.to({type:f,data:{file:t}}));return}l()})}),C=(0,k.nF)((e,t)=>{if((0,y.ck)()||!t.allowOnDesktop&&Date.now()-v<600)return;let a=(0,A._I)(t);if(N.Y5.resetLoadedFigFile(),o.eD){if(t.allowOnDesktop)(0,A.$N)(e,t,!1);else{(0,A.J5)(e,t);return}}else if(t.openNewFileIn===R.ai.NEW_TAB){let e=(0,_.lF)(a);l.Ay.redirect(`/file/new${e?"?"+e:""}`,"_blank")}else if((0,n.N7)(e.getState().currentUserOrgId,t.org_id)){s.zl.get(d.b)&&(0,c.$D)(m.e.SCENEGRAPH_AND_SYNC,Error("Trying to switching org ids while in offline file browser"));let e=(0,_.lF)(a);l.Ay.redirect(`/file/new${e?"?"+e:""}`)}else(0,A.$N)(e,t,!1);v=Date.now();let i=t.openNewFileIn===R.ai.SAME_TAB&&(!o.eD||t.allowOnDesktop)?I.Oin.HIDE_UI:I.Oin.OFF;e.dispatch(G({openNewFileIn:t.openNewFileIn,progressBarMode:i}))}),G=(0,i.N)("FULLSCREEN_NEW_FILE_OPEN")},57858:(e,t,a)=>{a.d(t,{$W:()=>l});var i=a(39863);let r=[{name:"iPhone 14 & 15 Pro Max",width:430,height:932,i18nName:()=>(0,i.t)("presets.i_phone_14_and_15_pro_max")},{name:"iPhone 14 & 15 Pro",width:393,height:852,i18nName:()=>(0,i.t)("presets.i_phone_14_and_15_pro")},{name:"iPhone 13 & 14",width:390,height:844,i18nName:()=>(0,i.t)("presets.i_phone_13_and_14")},{name:"iPhone 14 Plus",width:428,height:926,i18nName:()=>(0,i.t)("presets.i_phone_14_plus")},{name:"iPhone 13 mini",width:375,height:812,i18nName:()=>(0,i.t)("presets.i_phone_13_mini")},{name:"iPhone SE",width:320,height:568,i18nName:()=>(0,i.t)("presets.i_phone_se")},{name:"iPhone 8 Plus",width:414,height:736,i18nName:()=>(0,i.t)("presets.i_phone_8_plus")},{name:"iPhone 8",width:375,height:667,i18nName:()=>(0,i.t)("presets.i_phone_8")},{name:"Android Small",width:360,height:640,i18nName:()=>(0,i.t)("presets.android_small")},{name:"Android Large",width:360,height:800,i18nName:()=>(0,i.t)("presets.android_large")}],n=[{name:"MacBook Air",width:1280,height:832,i18nName:()=>(0,i.t)("presets.mac_book_air_m2")},{name:'MacBook Pro 14"',width:1512,height:982,i18nName:()=>(0,i.t)("presets.mac_book_pro_14")},{name:'MacBook Pro 16"',width:1728,height:1117,i18nName:()=>(0,i.t)("presets.mac_book_pro_16")},{name:"Desktop",width:1440,height:1024,i18nName:()=>(0,i.t)("presets.desktop")},{name:"Wireframe",width:1440,height:1024,i18nName:()=>(0,i.t)("community.categories.wireframe")},{name:"TV",width:1280,height:720,i18nName:()=>(0,i.t)("presets.tv")}],o=[{name:"Slide 16:9",width:1920,height:1080,i18nName:()=>(0,i.t)("presets.slide_16_9")},{name:"Slide 4:3",width:1024,height:768,i18nName:()=>(0,i.t)("presets.slide_4_3")}],l=(s(Object.values({phonePresets:r,tabletPresets:[{name:"Surface Pro 8",width:1440,height:960,i18nName:()=>(0,i.t)("presets.surface_pro_8")},{name:"iPad mini 8.3",width:744,height:1133,i18nName:()=>(0,i.t)("presets.i_pad_mini_8_3")},{name:'iPad Pro 11"',width:834,height:1194,i18nName:()=>(0,i.t)("presets.i_pad_pro_11")},{name:'iPad Pro 12.9"',width:1024,height:1366,i18nName:()=>(0,i.t)("presets.i_pad_pro_12_9")}],desktopPresets:n,presentationPresets:o,watchPresets:[{name:"Apple Watch 41mm",width:176,height:215,i18nName:()=>(0,i.t)("presets.apple_watch_41_mm")},{name:"Apple Watch 45mm",width:198,height:242,i18nName:()=>(0,i.t)("presets.apple_watch_45_mm")},{name:"Apple Watch 44mm",width:184,height:224,i18nName:()=>(0,i.t)("presets.apple_watch_44_mm")},{name:"Apple Watch 40mm",width:162,height:197,i18nName:()=>(0,i.t)("presets.apple_watch_40_mm")}],paperPresets:[{name:"A4",width:595,height:842,i18nName:()=>(0,i.t)("presets.a_4")},{name:"A5",width:420,height:595,i18nName:()=>(0,i.t)("presets.a_5")},{name:"A6",width:297,height:420,i18nName:()=>(0,i.t)("presets.a_6")},{name:"Letter",width:612,height:792,i18nName:()=>(0,i.t)("presets.letter")},{name:"Tabloid",width:792,height:1224,i18nName:()=>(0,i.t)("presets.tabloid")}],socialMediaPresets:[{name:"Twitter post",width:1200,height:675,i18nName:()=>(0,i.t)("presets.twitter_post")},{name:"Twitter header",width:1500,height:500,i18nName:()=>(0,i.t)("presets.twitter_header")},{name:"Facebook post",width:1200,height:630,i18nName:()=>(0,i.t)("presets.facebook_post")},{name:"Facebook cover",width:820,height:312,i18nName:()=>(0,i.t)("presets.facebook_cover")},{name:"Instagram post",width:1080,height:1080,i18nName:()=>(0,i.t)("presets.instagram_post")},{name:"Instagram story",width:1080,height:1920,i18nName:()=>(0,i.t)("presets.instagram_story")},{name:"Dribbble shot",width:400,height:300,i18nName:()=>(0,i.t)("presets.dribbble_shot")},{name:"Dribbble shot HD",width:800,height:600,i18nName:()=>(0,i.t)("presets.dribbble_shot_hd")},{name:"LinkedIn cover",width:1584,height:396,i18nName:()=>(0,i.t)("presets.linked_in_cover")}],figmaPresets:[{name:"Plugin icon",width:128,height:128,i18nName:()=>(0,i.t)("presets.plugin_icon")},{name:"Profile banner",width:1680,height:240,i18nName:()=>(0,i.t)("presets.profile_banner")},{name:"Plugin / file cover",width:1920,height:1080,i18nName:()=>(0,i.t)("presets.plugin_file_cover")}],archivedPresets:[{name:"iPhone 13 Pro Max",width:428,height:926,i18nName:()=>(0,i.t)("presets.i_phone_13_pro_max")},{name:"iPhone 13 / 13 Pro",width:390,height:844,i18nName:()=>(0,i.t)("presets.i_phone_13_13_pro")},{name:"iPhone 11 Pro Max",width:414,height:896,i18nName:()=>(0,i.t)("presets.i_phone_11_pro_max")},{name:"iPhone 11 Pro / X",width:375,height:812,i18nName:()=>(0,i.t)("presets.i_phone_11_pro_x")},{name:"Google Pixel 2",width:411,height:731,i18nName:()=>(0,i.t)("presets.google_pixel_2")},{name:"Google Pixel 2 XL",width:411,height:823,i18nName:()=>(0,i.t)("presets.google_pixel_2_xl")},{name:"iPad mini 5",width:768,height:1024,i18nName:()=>(0,i.t)("presets.i_pad_mini_5")},{name:"Surface Pro 4",width:1368,height:912,i18nName:()=>(0,i.t)("presets.surface_pro_4")},{name:"MacBook",width:1152,height:700,i18nName:()=>(0,i.t)("presets.mac_book")},{name:"MacBook Pro",width:1440,height:900,i18nName:()=>(0,i.t)("presets.mac_book_pro")},{name:"Surface Book",width:1500,height:1e3,i18nName:()=>(0,i.t)("presets.surface_book")},{name:"Apple Watch 42mm",width:156,height:195,i18nName:()=>(0,i.t)("presets.apple_watch_42_mm")},{name:"Apple Watch 38mm",width:136,height:170,i18nName:()=>(0,i.t)("presets.apple_watch_38_mm")},{name:"iMac",width:1280,height:720,i18nName:()=>(0,i.t)("presets.i_mac")},{name:"Macintosh 128k",width:512,height:342,i18nName:()=>(0,i.t)("presets.mac_128k")}]})),s([r,n,o]));function s(e){return e.reduce((e,t)=>{for(let a of t)e[a.name]=a;return e},{})}},35926:(e,t,a)=>{let i,r,n,o,l,s,d,_,c,m,u,p,h,f,g,w,T,E;a.d(t,{J5:()=>t2,_I:()=>tZ,$N:()=>t8});var N,v=a(43407),y=a(84934),A=a(17333),I=a(32284),b=a(37947),P=a(20331),D=a(66712),F=a(74626),R=a(16082),S=a(77432),M=a(208);let k=function e(){return new Promise(t=>{let a=()=>{window.removeEventListener("online",a),k=e(),t()};window.addEventListener("online",a)})}();function L(e){return"canceled"===e}class O{constructor(e){this._resolveCancelPromise=()=>{},this._cancelPromise=new Promise(e=>{this._resolveCancelPromise=e}),this._result=this.startRequest(e)}getResult(){return this._result}cancelRequest(){this._resolveCancelPromise("canceled")}async startRequest(e){let t=0;for(;;){let a=k;try{return await Promise.race([e(),this._cancelPromise])}catch(e){if(e instanceof M.Dr){if(e.status>=400&&e.status<500)throw e}else throw e}let i=await Promise.race([this._cancelPromise,(0,S.fm)(Math.min(500*Math.pow(2,t),6e4)),a]);if(i&&L(i))return i;t++}}}var U=a(79940),C=a(76621),G=a(50322),x=a(4783),V=a(43282),j=a(64887),B=a(81388),z=a(39863),H=a(62194),W=a(86640),$=a(56975),K=a(38269),Y=a(39671);a(76485);var J=a(47899),q=a(88022),Q=a(99506),X=a(20425);let Z="Enter Inspect Mode";var ee=a(44682),et=a(93017),ea=a(93360);a(82656);var ei=a(2957),er=a(29403);a(57858);var en=a(6949);a(74105);var eo=a(15467),el=a(56390),es=a(52800),ed=a(33739),e_=a(22983),ec=a(24266),em=a(60640),eu=a(9511);a(32135);var ep=a(5487),eh=a(76615);a(94517);var ef=a(45020),eg=a(47807),ew=a(30654),eT=a(65050);let eE=ew.object({script:ew.string(),name:ew.string(),file_key:ew.string(),source_file_key:ew.string().nullable(),needs_upgrade:ew.boolean(),org_drafts_owners:ew.array(eT.WU),prefix:ew.string(),shared_fonts:ew.ignore(),feature_flags:ew.ignore(),is_community_duplicate:ew.boolean(),file_repo:ew.ignore(),can_edit:ew.boolean(),show_edit_button:ew.boolean(),current_team_user:ew.ignore(),redirect_to_password_auth:ew.boolean().optional(),last_published_at:ew.string().nullable(),team:ew.ignore(),is_team_template:ew.boolean()}),eN=new class{constructor(){this.FileMetadataSchemaValidator=(0,eg.YV)("FileMetadataSchemaValidator",eE,null,!1)}getFileMetadata(e){let t=new URLSearchParams(b.Ay.location.search),a=new URLSearchParams,i=t.get("force-incremental")||"";""!==i&&a.append("force-incremental",i);let r=t.get("preload")||"";return""!==r&&a.append("preload",r),this.FileMetadataSchemaValidator.validate(async({xr:t})=>await t.get(`/api/file_metadata/${e.fileKey}?${a.toString()}`))}};var ev=a(85990);let ey=new class{constructor(){this.VariableSetDefaultModeSettingSchemaValidator=(0,eg.vh)()}getDefaultModes(e){return this.VariableSetDefaultModeSettingSchemaValidator.validate(({xr:t})=>{if("folderId"in e)return t.get("/api/variable_set_default_modes/"+e.folderId);{let{fileKeyOrHubFileId:a,...i}=e;return t.get("/api/variable_set_default_modes",eg.td.toAPIParameters((0,ev.Xx)(i,a)))}})}setDefaultMode(e){let{fileKeyOrHubFileId:t,...a}=e;return M.Ay.post("/api/variable_set_default_modes",eg.td.toAPIParameters((0,ev.Xx)(a,t)))}deleteDefaultMode(e){let{fileKeyOrHubFileId:t,...a}=e;return M.Ay.del("/api/variable_set_default_modes",eg.td.toAPIParameters((0,ev.Xx)(a,t)))}};var eA=a(38580),eI=((i=eI||{}).BRAINSTORM_TEMPLATE_BUTTON_INTERACTED="Make something modal V2 brainstorm template interacted",i.TEAM_UPDATES_TEMPLATE_BUTTON_INTERACTED="Make something modal V2 team updates template interacted",i.TEAM_CHART_TEMPLATE_BUTTON_INTERACTED="Make something modal V2 team chart template interacted",i.PLANNING_AHEAD_TEMPLATE_BUTTON_INTERACTED="Make something modal V2 planning ahead template interacted",i),eb=((r=eb||{}).BRAINSTORM="BRAINSTORM",r.UPDATES="TEAM UPDATES",r.PLAN="PLANNING AHEAD",r.TEAM="TEAM CHART",r.NONE="NONE",r),eP=((n=eP||{}).NOT_STARTED="NOT_STARTED",n.MODAL_SHOWING="MODAL_SHOWING",n.USE_CASE_STEPS="USE_CASE_STEPS",n.COMPLETED="COMPLETED",n);(0,eA.eU)("NOT_STARTED");let eD=(0,eA.eU)(eb.NONE);(0,eA.eU)(!1);var eF=a(11855),eR=a(88507);a(11617),a(97170),a(60945),a(63706),a(61870),a(95847),a(46689),a(24897),a(63659),a(72517),a(62275),a(55258),a(1538),a(98371);var eS=a(38329),eM=a(99737),ek=a(35682);a(60178);var eL=a(79453),eO=a(79296);(0,eO.D)(()=>{let e=(0,F.md)(ek.ze);return(0,eM.Rs)(eL.jmg,{fileKey:e||""})}),(0,eA.eU)(!1),a(57766),a(37499),a(11978),a(24857),a(28467);var eU=a(44673);a(99111),a(87337),a(81912),a(33556),a(86459),a(45356),a(40908),a(42830),a(11538);a(21112);var eC=a(60601);let eG=(0,eA.eU)({read:!1,write:()=>{}});(0,eA.eU)({read:[],write:eC.lQ});var ex=a(67528),eV=a(31828),ej=((o=ej||{}).AI="AI",o.STANDARD="Standard",o),eB=a(97306),ez=a(41860);class eH{constructor(){this.allTemplateInfo=new Set,this.nodeGUIDsToTemplate=new Map,eH.instance=this}static removeInstance(){eH.instance=void 0}trackNodesAsTemplate(e,t,a,i){let r=ez.qo.instance;if(Array.from(t).forEach(e=>{eW(r.get(e))||t.delete(e)}),0===t.size)return;let n=Math.floor(.1*t.size),o={templateId:e,fileKey:a,nodeGUIDs:t,trackedNodeCount:t.size,deletionThreshold:n,creationMethod:i};this.allTemplateInfo.add(o),t.forEach(e=>this.nodeGUIDsToTemplate.set(e,o))}checkForTemplateNodesDeletion(e){0!==this.allTemplateInfo.size&&e.forEach(e=>this.checkForTemplateNodeDeletion(e))}checkForTemplateNodeDeletion(e){let t=this.nodeGUIDsToTemplate.get(e);if(!t)return;this.nodeGUIDsToTemplate.delete(e);let a=t.nodeGUIDs;if(a.delete(e),a.size<=t.deletionThreshold){var i,r,n,o,l;this.stopTrackingTemplate(t),i="template_deleted",r={templateId:t.templateId,fileKey:t.fileKey,productType:"figjam",trackedNodeCount:t.trackedNodeCount,creationMethod:t.creationMethod},(0,C.Lo)(i,"trackTemplateEvent",r),(0,y.sx)(i,{userId:null==(l=null==(o=null==(n=eS.D)?void 0:n.getState())?void 0:o.user)?void 0:l.id,...r},{forwardToDatadog:!0})}}stopTrackingTemplate(e){this.allTemplateInfo.delete(e),e.nodeGUIDs.forEach(e=>this.nodeGUIDsToTemplate.delete(e))}}let eW=e=>!!e&&("CANVAS"===e.type?e.visible:eW(e.parentNode));async function e$(e,t,a,i,{enableTracking:r=!0}={}){let n=eH.instance;if(!r||!n)return await i();let o=(0,eB.UP)(),l=await i(),s=new Set((0,eB.UP)());return o.forEach(e=>s.delete(e)),t||(t="null"),n.trackNodesAsTemplate(e(),s,t,a),l}var eK=a(78260),eY=a(82947),eJ=a(6757),eq=a(40596);a(28906),a(58145),a(50769);var eQ=a(85052);new eQ.b("action"),new eQ.b("action"),a(14716),a(57630),a(9798),a(7465),a(89584),a(88300);var eX=((l=eX||{})[l.TRUE=0]="TRUE",l[l.FALSE=1]="FALSE",l[l.LOADING=2]="LOADING",l);let eZ=(0,eA.eU)(eX.FALSE);a(17068);var e0=a(74724),e1=((s=e1||{}).NEVER="never",s.ONCE="once",s.MORETHANEONCE="morethanonce",s),e8=((d=e8||{})[d.ENTRY=0]="ENTRY",d[d.PROMPT_BUILDER=1]="PROMPT_BUILDER",d),e2=((_=e2||{}).MEETING="meeting",_.GANTT_CHART="gantt_chart",_.BRAINSTORM="brainstorm",_.FLOW_CHART="flow_chart",_.ORG_CHART="org_chart",_.PLAN="plan",_.MIND_MAP="mind_map",_.TIMELINE="timeline",_),e4=((c=e4||{}).WEEKLY_SYNC="weekly_sync",c.PLAN="plan",c.BRAINSTORM="brainstorm",c.TEAM_RETRO="team_retro",c.ONEONONE="1:1",c.GANTT_CHART="gantt_chart",c.FLOW_CHART="flow_chart",c.ORG_CHART="org_chart",c.MIND_MAP="mind_map",c.TIMELINE="timeline",c),e6=((m=e6||{}).IN_EDITOR="in_editor",m.TEMPLATE_SHELF="template_shelf",m.COMMUNITY="community",m.ONBOARDING_MODAL="onboarding_modal",m),e3=((u=e3||{}).GENERATE_MODE="generate_stage",u.REFINEMENT_MODE="refinement_stage",u),e7=((p=e7||{}).TEMPLATE="template",p.VISUAL="visual",p);async function e5({prompt:e,signal:t,authInfo:a}){let i=await e0.Ay.figjam.classifyCreate({prompt:e},a);return t.aborted?null:i.type}async function e9(e){let t=new TextEncoder().encode(e);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("")}a(63142);var te=((h=te||{}).FREEFORM="freeform",h.SUGGESTION="suggestion",h.AUTOCOMPLETE="autocomplete",h),tt=((f=tt||{}).AI_PROMPT_EDITED="ai_prompt_edited",f.AI_PROMPT_BUILDER_OUTPUT_REQUESTED="ai_prompt_builder_output_requested",f.AI_PROMPT_BUILDER_OUTPUT_STREAMING="ai_prompt_builder_output_streaming",f.AI_PROMPT_BUILDER_OUTPUT_CREATED="ai_prompt_builder_output_created",f.AI_PROMPT_REQUEST_ERROR="ai_prompt_request_error",f.AI_PROMPT_SUGGESTIONS_VIEWED="ai_prompt_suggestions_viewed",f);let ta=e=>"board"===e?"template":"visual";function ti(e,t,a,i,r,n,o,l,s,d,_){let c="inappropriate"===r?r:ta(r);e9(i).then(r=>{(0,y.sx)("ai_prompt_builder_output_requested",{fileKey:e,variantIndex:t,numVariants:a,promptId:r,outputType:c,oneClickPromptUseCase:s,oneClickPromptUseCaseCategory:l,oneClickPromptUseCaseSubCategory:d,numCharactersInput:i.length,localOutputId:F.zl.get(to),stage:n,uiTriggeredFrom:o,autocompletePromptAddition:_},{forwardToDatadog:!0})})}function tr(e,t){(0,y.sx)("ai_prompt_request_error",{fileKey:e,errorMessage:t},{forwardToDatadog:!0})}let tn=(0,eA.eU)(null),to=(0,eA.eU)(0);var tl=((g=tl||{}).LOADING="loading",g.ERROR="error",g.SUCCESS="success",g.NONE="none",g),ts=a(99999),td=a(9225),t_=a(15009),tc=a(62531),tm=a(90833);async function tu(e,t){let a="";switch(e){case"COMPONENT":a=await (0,tm.$C)(t);break;case"COMPONENT_SET":a=await (0,tm.$f)(t);break;default:throw Error(`Unknown component type ${e}`)}return a}async function tp({prompt:e,signal:t,fileKey:a,authInfo:i,shouldJumpToNewLine:r=null,orgId:n}){var o,l,s;let d,_;d=globalThis.AI_DEBUG_XML&&(0,D.kc)().figjam_text_to_template_debug?await e0.Ay.figjam.createTemplate({prompt:e,mode:ts.Wc.PASSTHROUGH_XML_DEBUG_ONLY},i):await e0.Ay.figjam.createTemplate({prompt:e,mode:ts.Wc.DESCRIPTION},i),await el.Y5.onReady(),es.vlL.resetInsertionLocation(r);let c=d.getReader(),m=[];async function u(){if(0===m.length)return;let e=performance.now();for(;performance.now()-e<32;){let e=m.shift();if(!e)break;let t=tc.l7.system("ai-add-template",()=>es.vlL.handleFigJamTemplateStreamMessage(e));(0,C.Lo)("handleTextToTemplate","Create or update response message",{message:t})}await new Promise(e=>setTimeout(e,0))}try{for(;;){await u();let{done:i,value:r}=await c.read();if(t.aborted)break;if(null==r?void 0:r.createNodes)for(let e of r.createNodes){if((0,C.Lo)("handleTextToTemplate","Create or update node",e),"INSTANCE"===e.node.type&&e.node.componentType&&e.node.componentKey){let t=(0,t_.Po)(e.node.componentKey);try{let a=await tu(e.node.componentType,t);a&&(e.node.componentId=a)}catch(e){(0,C.Lo)("handleTextToTemplate","Error importing component (e.g., sticker)",e)}}else if("WIDGET"===e.node.type){if(e.node.pluginData&&e.node.pluginData.pluginSvgPreviewUrl)try{let t=await fetch(e.node.pluginData.pluginSvgPreviewUrl).then(async e=>(e.ok||(0,C.Lo)("handleTextToTemplate","Error importing widget svg"),await e.text()));t&&(e.node.pluginData.pluginSvgPreviewData=t)}catch(e){(0,C.Lo)("handleTextToTemplate","Error importing widget",e)}if(e.node.pluginId){let t;try{t=await (0,td.Ek)(eL.k_1,{pluginId:e.node.pluginId,orgId:n})}catch(e){(0,C.Lo)("handleTextToTemplate","Error getting plugin",e)}(null==t?void 0:t.status)==="loaded"&&(null==(o=t.data)?void 0:o.plugin)||(0,C.Lo)("handleTextToTemplate","Error getting plugin; plugin possibly not loaded yet");let a=(null==(s=null==(l=null==t?void 0:t.data)?void 0:l.plugin)?void 0:s.currentPluginVersionId)??"";a||(0,C.Lo)("handleTextToTemplate","Could not get latest plugin version ID"),e.node.pluginVersionId=a}}m.push(e)}if((null==r?void 0:r.trace)&&(_=r.trace,(0,C.Lo)("handleTextToTemplate","Trace data",{message:r.trace})),null==r?void 0:r.requestId){let t=r.requestId;!function(e,t,a,i,r){e9(a).then(t=>{(0,y.sx)("ai_prompt_builder_output_streaming",{fileKey:e,variantIndex:0,promptId:t,outputType:ta(i),cortexRequestId:r,localOutputId:F.zl.get(to)},{forwardToDatadog:!0})})}(a,0,e,"board",t),F.zl.set(tn,t)}if(i){(0,C.Lo)("handleTextToTemplate","Stream seems to be done.");break}}for(;m.length>0;)await u()}catch(e){throw e.trace=_,e}finally{tc.l7.system("ai-add-template-commit",()=>es.vlL.commitPreview()),c.releaseLock()}return _}async function th({prompt:e,visualType:t,signal:a,authInfo:i,ganttColor:r,ganttType:n}){let o=await e0.Ay.figjam.createVisual({prompt:e,visualType:t},i);a.aborted||((null==o?void 0:o.requestId)&&F.zl.set(tn,o.requestId),(null==o?void 0:o.trace)&&(0,C.Lo)("handleTextToVisual","Trace data",{message:o.trace}),await el.Y5.onReady(),function(e,t,{ganttType:a=es.VIy.BASIC,ganttColor:i=tf()}={}){switch(e){case"gantt":tc.l7.user("generate-figjam-ai-gantt-chart",()=>es.$mk.generateFigjamAiGanttChart(t,a,i));return;case"orgchart":case"diagram":tc.l7.user("generate-figjam-ai-flowchart",()=>es.$mk.generateFigjamAiFlowchart({type:"diagram"===t.type?es.vwB.DIAGRAM:es.vwB.ORG_CHART,direction:"horizontal"===t.direction?es.miP.HORIZONTAL:es.miP.VERTICAL,vertices:t.vertices,edges:t.edges},function(){let e=[es.QOd.PURPLE,es.QOd.BLUE,es.QOd.GREEN];return e[Math.floor(Math.random()*e.length)]}()));return;case"mindmap":tc.l7.user("generate-figjam-ai-mindmap",()=>es.$mk.generateFigjamAiMindmap(t));return;case"timeline":tc.l7.user("generate-figjam-ai-timeline",()=>es.$mk.generateFigjamAiTimeline(t,function(){let e=[es.Pls.BLUE,es.Pls.GREEN,es.Pls.PURPLE,es.Pls.RED,es.Pls.YELLOW];return e[Math.floor(Math.random()*e.length)]}()));return}}(t,o,{ganttColor:r,ganttType:n}))}function tf(){let e=[es.sFD.BLUE,es.sFD.GREEN,es.sFD.PURPLE,es.sFD.RED,es.sFD.YELLOW];return e[Math.floor(Math.random()*e.length)]}var tg=a(41092);a(92592);var tw=((w=tw||{}).SUMMARIZE="sticky-summarization-error",w.CLUSTER="sticky-cluster-error",w.GENERATE="generate-error",w),tT=((T=tT||{}).Reload="reload",T.Trace="trace",T);let tE=(0,eO.D)((e,t)=>{let a={"sticky-summarization-error":{content_length_limit_exceeded:(0,z.t)("whiteboard.ai_summary.content_length_limit_exceeded_error"),figjam_summarize_out_of_date:(0,z.t)("whiteboard.ai_summary.out_of_date_error"),rate_limit_exceeded:(0,z.t)("whiteboard.ai_summary.rate_limit_exceeded_error"),ai_opt_out_error:(0,z.t)("whiteboard.ai.ai_opt_out_error"),generic:(0,z.t)("whiteboard.ai_summary.generic_error"),service_issue:(0,z.t)("whiteboard.ai.service_issue_error"),unsafe_or_harmful_content:(0,z.t)("whiteboard.ai.inappropriate_input_error"),offline:(0,z.t)("whiteboard.ai.offline_error"),unauthorized:(0,z.t)("whiteboard.ai_summary.generic_error")},"sticky-cluster-error":{content_length_limit_exceeded:(0,z.t)("whiteboard.ai_cluster.content_length_limit_exceeded_error"),figjam_cluster_out_of_date:(0,z.t)("whiteboard.ai_cluster.out_of_date_error"),rate_limit_exceeded:(0,z.t)("whiteboard.ai_cluster.rate_limit_exceeded_error"),ai_opt_out_error:(0,z.t)("whiteboard.ai.ai_opt_out_error"),generic:(0,z.t)("whiteboard.ai_cluster.generic_error"),service_issue:(0,z.t)("whiteboard.ai.service_issue_error"),unsafe_or_harmful_content:(0,z.t)("whiteboard.ai.inappropriate_input_error"),offline:(0,z.t)("whiteboard.ai.offline_error"),unauthorized:(0,z.t)("whiteboard.ai_cluster.generic_error")},"generate-error":{content_length_limit_exceeded:(0,z.t)("whiteboard.ai_generate.content_length_limit_exceeded_error"),rate_limit_exceeded:(0,z.t)("whiteboard.ai_generate.rate_limit_error"),ai_opt_out_error:(0,z.t)("whiteboard.ai.ai_opt_out_error"),generic:(0,z.t)("whiteboard.ai_generate.unknown_error"),service_issue:(0,z.t)("whiteboard.ai.service_issue_error"),unsafe_or_harmful_content:(0,z.t)("whiteboard.ai.inappropriate_input_error"),figjam_templates_out_of_date:(0,z.t)("whiteboard.ai_generate.out_of_date_error"),offline:(0,z.t)("whiteboard.ai.offline_error"),unauthorized:(0,z.t)("whiteboard.ai_generate.unknown_error")}},i="generic",r=!0;if(e instanceof tg.G1)switch(e.type){case"content_length_limit_exceeded":i="content_length_limit_exceeded";break;case"figjam_summarize_out_of_date":i="figjam_summarize_out_of_date";break;case"figjam_cluster_out_of_date":i="figjam_cluster_out_of_date";break;case"figjam_templates_out_of_date":i="figjam_templates_out_of_date";break;case"rate_limit_exceeded":i="rate_limit_exceeded";break;case"service_issue":i="service_issue";break;case"offline":i="offline",r=!1;break;case"unsafe_or_harmful_content":i="unsafe_or_harmful_content",r=!1;break;case"unauthorized":i="unauthorized",r=!1;break;case"figjam_visual_parsing_error":i="generic",r=!1;break;case"generic":if(429===e.data.status){i="rate_limit_exceeded";break}403===e.data.status&&(i="ai_opt_out_error")}let n=a[t],o=n[i]??n.generic;return{type:i,message:o,reportToSentry:r}});var tN=((E=tN||{}).NONE="none",E.TOP_BAR="top-bar",E.NEW_FILE="new-file",E);let tv="used_figjam_ai_generate",ty="used_figjam_ai_generate_modal_v2",tA=(0,eA.eU)(!1),tI=(0,eA.eU)(null,(e,t)=>{t(tA,!0),t(tC,void 0)}),tb=(0,eA.eU)(null,(e,t)=>{t(tR),t(tA,!1)}),tP=(0,eA.eU)(!1),tD=(0,eA.eU)(null,(e,t)=>{t(tR),t(tP,!0)}),tF=(0,eA.eU)(e=>e(tA)?"top-bar":(e(eZ)===eX.TRUE||e(tL))&&!e(tP)&&e(eD)===eb.NONE?"new-file":"none"),tR=(0,eA.eU)(null,(e,t)=>{t(tM),t(tL,!1),t(tC,void 0)});(0,eA.eU)(null,(e,t)=>{let a=e(tF);"top-bar"===a?t(tb):"new-file"===a&&t(tD)});let tS=(0,eA.eU)(null,(e,t)=>{e(tH).abort(),t(tH,new AbortController),t(tB,{status:tl.NONE})});(0,eA.eU)(null,(e,t)=>{t(tR),t(tP,!1),t(tA,!1)});let tM=(0,eA.eU)(null,(e,t)=>{t(tS),t(tO,e8.ENTRY),t(tx,void 0),t(tV,tf()),t(tj,es.VIy.BASIC)});(0,eA.eU)(null,(e,t)=>{t(tO,e8.PROMPT_BUILDER)});let tk=(0,eA.eU)(e8.ENTRY),tL=(0,eA.eU)(!1),tO=(0,eA.eU)(null,(e,t,a)=>{a===e8.PROMPT_BUILDER&&t(tL,!0),t(tk,a)});(0,eA.eU)(e=>e(tk));let tU=(0,eA.eU)(""),tC=(0,eA.eU)(void 0),tG=(0,eA.eU)(""),tx=(0,eA.eU)(void 0),tV=(0,eA.eU)(tf()),tj=(0,eA.eU)(es.VIy.BASIC),tB=(0,eA.eU)({status:tl.NONE}),tz=(0,eq.Wh)(()=>(0,eA.eU)(!1));(0,eA.eU)(null,(e,t,a)=>{t(tz,a)});let tH=(0,eA.eU)(new AbortController),tW=(0,eA.eU)(null,async(e,t,{fileKey:a,prompt:i,stage:r,useCaseCategory:n,useCase:o,subtitle:l,entrypoint:s,jumpToNewLine:d,fromGenerateModalV2:_})=>{let c;if(null===a&&(0,C.$D)(x.e.FIGJAM_ENGAGEMENT,Error("No file key provided for FigJam AI Generate request")),!i)return{status:tl.NONE};t(to,e=>e+1),e((0,eY.r1)(tv)).data||eS.D.dispatch(eV.b({[tv]:!0}));let m=e((0,eY.r1)(ty)).data;_&&!m&&eS.D.dispatch(eV.b({[ty]:!0})),t(tS);let u=e(tH).signal,p={orgId:e(eK._s),teamId:e(ek.As)||null,fileKey:a,userId:e(eJ.kS)||null};t(tB,{status:tl.LOADING}),t(tx,n),t(tO,e8.PROMPT_BUILDER);let h="board";try{globalThis.AI_DEBUG_XML&&(0,D.kc)().figjam_text_to_template_debug?h="board":(h=await e5({prompt:i,signal:u,authInfo:p})||"board",(0,D.kc)().figjam_text_to_visual_timeline||"timeline"!==h||(h="gantt"),(!(0,D.kc)().figjam_text_to_visual_mindmap||!(0,D.kc)().figjam_mindmaps_entry_enable)&&"mindmap"===h&&(h="board"))}catch(d){let e=tE(d,tw.GENERATE);return c={status:tl.ERROR,type:h,errorMessage:e.message,trace:d.trace},ti(a,0,1,i,"inappropriate",r,s,n,o,l),tr(a,e.message),e.reportToSentry&&(0,C.$D)("board"===h?x.e.FIGJAM_ENGAGEMENT:x.e.FIGJAM_CORE,d),t(tB,c),c}n&&(n===e4.FLOW_CHART?h="diagram":n===e4.GANTT_CHART?h="gantt":n===e4.ORG_CHART&&(h="orgchart"));let f=e(tG),g=f&&i.includes(f)?f:void 0;t(tG,""),ti(a,0,1,i,h,r,s,n,o,l,g);try{c=await e$(()=>e(tn)||"null",a,ej.AI,async()=>{let t;if("board"===h){let r=d||null,n=e(eK._s);t=await tp({prompt:i,signal:u,fileKey:a,authInfo:p,shouldJumpToNewLine:r,orgId:n})}else{let t=e(tj),a=e(tV),r=h;await th({prompt:i,signal:u,visualType:r,authInfo:p,ganttColor:a,ganttType:t})}let r=e(tn);return!function(e,t,a,i,r){e9(a).then(t=>{(0,y.sx)("ai_prompt_builder_output_created",{fileKey:e,variantIndex:0,promptId:t,outputType:ta(i),cortexRequestId:r,localOutputId:F.zl.get(to)},{forwardToDatadog:!0})})}(a,0,i,h,r),{status:tl.SUCCESS,type:h,trace:t}})}catch(e){if((null==e?void 0:e.name)==="AbortError")c={status:tl.NONE};else{let t=tE(e,tw.GENERATE);c={status:tl.ERROR,type:h,errorMessage:t.message,trace:e.trace},t.reportToSentry&&(0,C.$D)("board"===h?x.e.FIGJAM_ENGAGEMENT:x.e.FIGJAM_CORE,e),tr(a,t.message)}}return t(tB,c),c});(0,eA.eU)(null,(e,t,{prompt:a,stage:i,useCaseCategory:r,useCase:n,subtitle:o,entrypoint:l,jumpToNewLine:s,fromGenerateModalV2:d})=>{let _=e(ek.ze);if(null===_||0===_.length){(0,C.$D)(x.e.FIGJAM_ENGAGEMENT,Error("No file key found for loaded file to use for FigJam AI Generate request"));return}t(tW,{fileKey:_,prompt:a,stage:i,useCaseCategory:r,useCase:n,subtitle:o,entrypoint:l,jumpToNewLine:s,fromGenerateModalV2:d})});let t$=(0,eA.eU)(null,(e,t,{fileKey:a,prompt:i,stage:r,useCaseCategory:n,useCase:o,subtitle:l,entrypoint:s,jumpToNewLine:d,fromGenerateModalV2:_})=>{t(tW,{fileKey:a,prompt:i,stage:r,useCaseCategory:n,useCase:o,subtitle:l,entrypoint:s,jumpToNewLine:d,fromGenerateModalV2:_})});class tK{constructor(){this._isCanceled=!1,this._onCanceled=null,this._resolveCompletionPromise=()=>{},this._promise=new Promise(e=>{this._resolveCompletionPromise=e})}cancel(){this._isCanceled=!0,this._onCanceled&&this._onCanceled()}setOnCanceled(e){this._onCanceled=e}get isCanceled(){return this._isCanceled}done(){return this._resolveCompletionPromise()}waitForCompletion(){return this._promise}}let tY=null;var tJ=a(49793),tq=a(61060);async function tQ(e,t,a,i,r){var n,o,l;let s=e.getState(),d=s.selectedView,_=d&&"fullscreen"===d.view;if(!_)return;(0,C.sC)(await ep.M4.fetchFile(t));let c=(0,eh.w2)((0,eh.i_)(s.theme.themePreference));mpGlobal.preconnect(mpGlobal.url({fileKey:t,role:"editor",initialBgColor:c,suppressDecodeErrors:!1,connectionType:i,tagForLogging:a===Y.nT.DevHandoff?"dev_mode":void 0,forceViewOnly:tJ.z4.getIsExtension()})),await el.Y5.loadAndStartFullscreenIfNecessary(),es.glU.setEditorType((0,Y.xq)(a)),es.glU.setEditorTheme(s.theme.visibleTheme||"");let m=(await (r?(async()=>{let e=new O(()=>eN.getFileMetadata({fileKey:t})),a=await e.getResult();if(L(a))throw Error("Request was canceled");return a})():eN.getFileMetadata({fileKey:t}))).data.meta;if(!(_=(d=(s=e.getState()).selectedView)&&"fullscreen"===d.view))return;!function(e,t,a){var i,r;let n=JSON.stringify((null==(i=b.Ay.location.state)?void 0:i.previousSelectedView)||{}),o="fullscreen"===t.selectedView.view?null==(r=t.selectedView.trackingInfo)?void 0:r.source:"";(0,q.ds)("File Opened",e.key,t,{randomID:(0,e_.ds)(),prevView:n,source:o,authenticatedUserIds:t.authedUsers.orderedIds.filter(e=>{var a;return e!==(null==(a=t.user)?void 0:a.id)})}),"fullscreen"===t.selectedView.view&&(t.selectedView.editorType===Y.nT.Design||t.selectedView.editorType===Y.nT.DevHandoff)&&function(e,t,a,i,r={}){var n;let o=t===Y.nT.DevHandoff?Z:"Enter Design Mode",l={source:a,hasSeatForDevMode:(0,$.tn)(e),...r},s=null==(n=e.openFile)?void 0:n.key;(0,q.ds)(o,s,e,l,{forwardToDatadog:void 0}),(async()=>{if((0,D.Ay)().org_id&&(await (0,J.hW)("exp_dev_mode_last_active_full_tracking")).get("enabled",!1)&&s&&"init"!==a){let e=o===Z?Q.Mr.DEV_MODE_FILE_SEEN:Q.Mr.DESIGN_FILE_SEEN;X.L.postRecentActivity({fileKey:s,activityType:e})}})()}(t,t.selectedView.editorType,"init")}({key:t},s),(0,H.b)((0,Y.oD)(a)),function(e){var t;if(e!==Y.nT.Design&&e!==Y.nT.DevHandoff)return;let a=e===Y.nT.DevHandoff?"dev_handoff":"design";null==(t=W.x4)||t.setItem("last-used-design-editor-type",a)}(a),l={sharedFontsList:(0,I.Mx)(m.shared_fonts),localizedToUnlocalized:[],renames:{family:{},style:{}},sources:[es.jXp.SHARED]},em.xK.time("updateFontListFileMetadata",()=>{l.sharedFontsList=(0,ed.F8)(l.sharedFontsList||[]),e.dispatch(et.nN(l)),es.vXe.updateFontList({list:l.sharedFontsList,localizedToUnlocalized:[]})}),e.dispatch(et.kP({needsUpgrade:m.needs_upgrade})),el.Y5.figFileLoaded(t),es.glU.openFileWithServerMetadata({metadata:{file_key:m.file_key,source_file_key:m.source_file_key},startInCommentsMode:!1,newFile:!0,selectedNodeId:null,fallbackStateGroupId:null,urlViewport:null,additionalTopPadding:null,mainComponentLink:!1,shouldConnectToMultiplayer:mpGlobal.shouldConnectToMultiplayer,preserveUrlNodeId:!1});let u=m.team;u&&e.dispatch(ei.yJ({team:u,userInitiated:!1}));let p=await ep.M4.fetchFile(t),h=e.getState(),f=h.folders[p.folder_id||""],g=h.teams[p.team_id||""],w=(0,G.SH)(h.userEduGracePeriods,p.team_id||""),T=h.repos[p.file_repo_id||""],E=h.fileByKey[p.source_file_key||""],N=(0,ef.UE)(p,{folder:f,team:g,repo:T,sourceFile:E,can_delete:!0,can_edit:!0,can_edit_canvas:!0,can_access_dev_mode_entry_point:!0,can_access_full_dev_mode:!0,can_manage:!0,can_view:!0,showEditButton:m.show_edit_button,hasEduGracePeriod:w.isInValidGracePeriod,isFavorited:!!(null==E?void 0:E.is_favorited)});(0,Y.Nw)(a)&&(0,Y.fP)(a,N.editorType)&&((0,C.x1)("new file","editor type mismatch",{requested:a,file:N.editorType}),a=(0,Y.wN)(N.editorType)),e.dispatch(et.OB({file:N,fullscreenEditorType:a}));let v=m.current_team_user;v&&p.team_id&&e.dispatch(er.yJ({teamUsers:[v],teamId:p.team_id})),e.dispatch(et.QA({showEditButton:m.show_edit_button}));let y=!!(m.is_team_template&&(0,en.LQ)(s));null==(n=A.eD)||n.setIsLibrary(!!m.last_published_at),null==(o=A.eD)||o.setIsTeamTemplate(!!y)}async function tX(e,t,a){e.dispatch(et.Y6({mode:a?eu.Oin.HIDE_UI:eu.Oin.OFF})),await el.Y5.loadAndStartFullscreenIfNecessary(),(0,ec.NT)(es.FAf.DESIGN),(0,D.kc)().ce_new_missing_fonts_logging&&(0,tq.e8)();let i=e.getState().theme.visibleTheme;el.Y5.updateAppModel({themePreference:i}),es.glU.openEmptyFile((0,Y.xq)(t))}function tZ(e){let t={};return e.folder_id&&(t.folder_id=e.folder_id),e.org_id&&(t.org_id=e.org_id),e.framePresetName&&(t.frame_preset_name=e.framePresetName),e.editorType&&(t.editor_type=e.editorType),e.fileName&&(t.name=e.fileName),e.localFileKey&&(t.localFileKey=e.localFileKey),e.team_id&&(t.team_id=e.team_id),e.figjamAiNewFileData&&(t.figjamAiNewFile_prompt=e.figjamAiNewFileData.prompt,t.figjamAiNewFile_useCaseCategory=e.figjamAiNewFileData.useCaseCategory,t.figjamAiNewFile_subtitle=e.figjamAiNewFileData.subtitle,t.figjamAiNewFile_entrypoint=e.figjamAiNewFileData.entrypoint),e.figjamMakeSomethingUseCase&&(t.figjam_make_something_use_case=e.figjamMakeSomethingUseCase),e.slideTemplateLibraryKey&&(t.slide_template_library_key=e.slideTemplateLibraryKey),t}async function t0(e,t,a,i,r){var n,o;let l;await tX(e,(0,Y.wN)(t.editorType),i),"slides"===t.editorType&&(0,D.kc)().piper&&(0,D.kc)().piper_community_templates&&t.slideTemplateLibraryKey&&F.zl.set(eG,{type:ex.Vf.TEMPLATE,libraryKey:t.slideTemplateLibraryKey,parentView:{type:ex.Vf.ALL}}),r?(await r.onConnectNewFile(t),await (null==(n=r.session())?void 0:n.restoreAutosaveIfNeeded())):(0,C.Lo)("new file","failed to get autosave"),(t.nodeId||t.viewport)&&es.glU.restorePageAndViewportFromURL(t.nodeId??null,t.viewport??null);let s=t,d=()=>{var e,t;return(null==(e=null==r?void 0:r.fileCreationManager)?void 0:e.newFileInfo)&&(s=null==(t=null==r?void 0:r.fileCreationManager)?void 0:t.newFileInfo),s},_="slides"!==t.editorType&&(null==r?void 0:r.managerState)==="connected"&&j.yp&&!(0,P.w5)();if((0,D.kc)().ds_workspace_team_default_modes&&t.folder_id&&ey.getDefaultModes({folderId:t.folder_id}).then(e=>{let t=e.data.meta;for(let e of Object.keys(t))tc.l7.system("set-default-mode-from-workspace-team",()=>{es.CWU.setExplicitVariableModeForSelection(e,{guid:t[e],collectionKey:e},!1)})}),_){let e=0,i=performance.now();if(a.isCanceled)return{status:"canceled"};let r=new O(async()=>{e++;let t=tZ(d());return(await M.Ay.post("/api/files/create",t)).data});a.setOnCanceled(()=>r.cancelRequest());let n=await r.getResult();if(L(n))return{status:"canceled"};a.setOnCanceled(null);let o=Math.round(performance.now()-i);N.offlineFileCreated(e,o,t),l=n}else{(0,C.Lo)("new file","Offline file creation not supported",{editorType:t.editorType,autosaveState:null==r?void 0:r.managerState});let e=tZ(t);l=(await M.Ay.post("/api/files/create",e,{retryCount:t1})).data}let c=l.meta.fig_file;null==(o=A.eD)||o.setUrl({url:c.url,fileKey:c.key,oldLocalFileKey:null==r?void 0:r.fileKey});let m=null==r?void 0:r.fileCreationManager;m&&m.assignPendingRealFileKey(c.key),d(),s.fileName&&s.fileName!==c.name&&(e.dispatch(ee.yJ({file:{key:c.key,name:s.fileName},userInitiated:!0})),c.name=s.fileName);let u=function(e,t,a,i){let r=t.meta.fig_file,n=t.meta.team_user,o=t.meta.org_user;e(ee.yJ({file:r})),o&&e(ea.hZ({orgUsers:[o],orgId:o.org_id})),n&&e(er.yJ({teamUsers:[n],teamId:n.team_id}));let l=a?{uiTriggeredFrom:a.from,uiSelectedView:JSON.stringify(a.selectedView)}:{};return l.teamId=(null==n?void 0:n.team_id)||null,l.orgId=(null==o?void 0:o.org_id)||null,l.folderId=r.folder_id,l.authenticatedUserIds=i.authedUsers.orderedIds,l.offline=`${!navigator.onLine}`,(0,q.f5)("File Created",r,i,l),r.key}(e.dispatch,l,t.trackingInfo,e.getState());if("whiteboard"===t.editorType){if(t.figjamAiNewFileData){let e=(0,D.kc)().ai_generate_specific_prompts;F.zl.set(tI),F.zl.set(tU,t.figjamAiNewFileData.prompt),F.zl.set(t$,{fileKey:u,prompt:t.figjamAiNewFileData.prompt,useCaseCategory:t.figjamAiNewFileData.useCaseCategory,subtitle:t.figjamAiNewFileData.subtitle,stage:e3.GENERATE_MODE,entrypoint:t.figjamAiNewFileData.entrypoint,fromGenerateModalV2:e})}else t.figjamMakeSomethingUseCase&&F.zl.set(eD,t.figjamMakeSomethingUseCase)}return(0,C.Lo)("new file","Received file key for new file",{fileKey:u}),await tQ(e,u,(0,Y.wN)(t.editorType),"new-file",_),await (null==r?void 0:r.assignFileKeyForLocalFile(c.key)),t.callback&&t.callback(u),{status:"success"}}(e=>{e.fileCreationStarted=function(e){var t,a,i,r,n,o;(0,y.sx)("File Creation Start",{editorType:e.editorType,from:null==(t=e.trackingInfo)?void 0:t.from,selectedView:null==(i=null==(a=e.trackingInfo)?void 0:a.selectedView)?void 0:i.view,offline:!navigator.onLine,webLocksAvailable:j.yp}),(0,C.Lo)("new file","Creating a new file",{editorType:e.editorType,from:null==(r=e.trackingInfo)?void 0:r.from,selectedView:null==(o=null==(n=e.trackingInfo)?void 0:n.selectedView)?void 0:o.view})},e.offlineFileCreated=function(e,t,a){e>t1&&(async()=>{var i;let r=null==(i=(0,eo.ZG)())?void 0:i.session(),n=r?await r.getNodeChangeCount().catch(()=>0):0,o=(0,eo.GT)();(0,y.sx)("Offline File Creation",{editorType:a.editorType,requestDuration:t,requestAttempts:e,nodeChangeCount:n,hasChangedMetadata:null==o?void 0:o.hasChangedMetadata},{forwardToDatadog:!0})})().catch(()=>{})},e.fileCreationFailed=function(e,t,a,i,r){var n,o,l;let s=t instanceof M.Dr?t.status:void 0;(0,C.x1)("new file","failed to create new file",{msg:e,status:s,hasPersistedUserChanges:a});let d=Error(a?"failed to create new file with offline changes":"failed to create new file");d.cause=t,(0,C.$D)(x.e.SCENEGRAPH_AND_SYNC,d),(0,y.sx)("File Creation Failure",{editorType:r.editorType,msg:e,status:s,offline:!navigator.onLine,hasPersistedUserChanges:a,result:i,from:null==(n=r.trackingInfo)?void 0:n.from,selectedView:null==(l=null==(o=r.trackingInfo)?void 0:o.selectedView)?void 0:l.view},{forwardToDatadog:!0})}})(N||(N={}));let t1=2;function t8(e,t,a){let i;if(tY){(0,C.xi)("new file","File creation already in progress");return}let r=function(){if(tY)throw Error("File creation already in progress");return tY=new tK}();N.fileCreationStarted(t);let n=e.getState().user;if(n){let e=t.localFileKey??(0,v.r)(V.g);i=(0,eo.mu)(e,n.id)}else(0,C.Lo)("Autosave","Not creating manager for logged out user");t0(e,t,r,a,i).catch(e=>({status:"error",error:e})).then(async a=>{var r,o;if("canceled"===a.status)await (0,eo.yn)();else if("error"===a.status){let{error:l}=a,s=(o=(0,z.t)("user_facing_error.new_document"),navigator.onLine?l.message?l.message:o:(0,z.t)("user_facing_error.offline")),d=!!await (null==(r=null==i?void 0:i.session())?void 0:r.hasPersistedUserChanges()),_=d?"show_banner":"exit_editor";if(N.fileCreationFailed(s,l,d,_,t),"show_banner"===_)(0,C.Lo)("new file","Leaving editor open because file has unsynced persisted changes."),e.dispatch(B.s.error(s)),e.dispatch(et.JM());else{if(n&&i){let e=i.fileKey;(0,v.T)(e)&&await (0,eo.$3)(n.id,e)}await (0,eo.yn)(),e.dispatch(B.s.error(s)),e.dispatch(K.$T({view:"recentFiles"})),A.eD&&(A.eD.showFileBrowser(s),A.eD.close({suppressReopening:!0,shouldForceClose:!0}))}t.callback&&t.callback(null)}}).finally(()=>{(function(){if(!tY)throw Error("File creation already in progress");tY.done(),tY=null})(),(0,C.Lo)("new file","finished creating new file")}),e.dispatch(K.$T({view:"fullscreen",fileKey:void 0,framePresetName:t.framePresetName,editorType:(0,Y.wN)(t.editorType),canNavigateDesktopNewTab:t.allowOnDesktop,nodeId:t.nodeId,localFileName:t.fileName})),setTimeout(()=>(0,R.zo)(R.F_.CREATE_FILE),2e3)}function t2(e,t){var a;if(!A.eD)return;t.localFileKey||(t.localFileKey=(0,v.r)(V.g));let i={...tZ(t)},r=null==(a=e.getState().user)?void 0:a.id;r&&(i.fuid=r);let n=(0,U.lF)(i),o=new URL(`/file/new?${n}`,document.baseURI),l=t.trackingInfo?{...t.trackingInfo}:null;try{(null==l?void 0:l.selectedView)&&structuredClone(l.selectedView)}catch(e){(null==l?void 0:l.selectedView)&&(l.selectedView={view:l.selectedView.view})}let s={...t,trackingInfo:l,callback:void 0},d="desktopNewTab"===e.getState().selectedView.view;A.eD.createFile({url:o.href,newFileInfo:s,editorType:t.editorType,isFromNewTabPage:d}).then(({fileKey:e})=>{t.callback&&t.callback(e)}).catch(e=>{console.error(e)})}},42830:(e,t,a)=>{a.d(t,{o:()=>n});var i=a(86759);let r=null;async function n(){return r||(await (0,i.k0)("https://accounts.google.com/gsi/client",{cors:!1,waitForCondition:()=>"google"in window}),r=window.google)}},24857:(e,t,a)=>{a.d(t,{S:()=>d,f:()=>s});var i=a(11855),r=a(99737),n=a(91388),o=a(79453),l=a(28467);function s(e,t=!0){let a=(0,i.useMemo)(()=>{var t;return(null==(t=e.data)?void 0:t.map(e=>({key:e.key})))??[]},[e]),l=(0,r.p)(o.sMs,a,{enabled:a.length>0});return(0,i.useMemo)(()=>(function(e,t,a=!0){if("loaded"!==e.status)return e;let i={},r=!1,o=null;return(t.forEach(e=>{var t;if("loading"===e.result.status||"disabled"===e.result.status){r=!0;return}if("errors"===e.result.status){o=e.result.errors;return}i[e.args.key]=(null==(t=e.result.data.file)?void 0:t.hasPermission)??!1}),null!=o)?a?e:n.Qw.error(o):r?a?e:n.Qw.loading():n.Qw.loaded(e.data.filter(e=>i[e.key]))})(e,l,t),[l,e,t])}function d(e){let t=(0,l.usePermissionsState)();return(0,i.useMemo)(()=>{let a=(0,l.canViewFile)(e,t);return(0,r.gB)({result:a})},[e,t])}},20331:(e,t,a)=>{a.d(t,{R_:()=>I,w5:()=>A});var i=a(88823),r=a.n(i),n=a(11617),o=a(37947),l=a(66712),s=a(10004),d=a(208),_=a(62275),c=a(88022),m=a(49793),u=a(49719),p=a(47935),h=a(29594),f=a(80771),g=a(17333),w=a(63706),T=!1;let E=null,N=null,v=null,y=577==a.j?["mousemove","mousedown","keydown","touchstart","touchmove","wheel"]:null;function A(){return T}function I(e){let{user_data:t,idle_timeout_duration_in_secs:a,idle_timeout_last_active_at:i,idle_timeout_org_name:A,frame_context:I}=(0,l.Ay)();t&&a&&i&&A&&!T&&function(e,t,a,i,A,I){if((0,w.Q1)()||(0,w.Ji)()||w.Ay.isIpadNative)return;let b=`last-active-at-${e.email}`,P="idle_timeout_last_active_at_change",D=(0,n.GZ)(),F=D&&"embed"===A,R=D&&"integration"===A,S=.05*t,M=Math.min(60,t/2),k=new s.P,L=e=>{localStorage.setItem(b,e.toString()),k.sendToAllTabs(P)};L(a);let O=()=>{document.hasFocus()&&d.Ay.post(`/api/user/${e.id}/idle_timeout_last_active_at`,{is_embed:D.toString()&&!m.z4.getIsExtension()}).then(e=>{let t=e.data.meta.idle_timeout_last_active_at;t&&L(t)}).catch(e=>{401===e.status&&C()})},U=()=>{var e;return!!I&&(null==(e=I.getState().modalShown)?void 0:e.type)===h.xn},C=()=>{if(I&&(null==I?void 0:I.getState().authedUsers.orderedIds.length)===1&&((0,c.Pg)(),f.U2.clear()),F)o.Ay.reload("idleSessionTimeout-embed");else if(R){let{pathname:e,search:t}=o.Ay.location,a=`${e}${t}&integration_host=msft`;window.location.replace(a)}else m.z4.getIsExtension()&&(0,l.kc)().dt_dev_mode_vscode_idle_timeout?(0,u.$g)():o.Ay.redirect(`/idle_timeout?fuid=${e.id}&redirect_uri=${encodeURIComponent(window.location.href)}`)},G=()=>Math.floor(Date.now()/1e3);v&&y.forEach(e=>{document.removeEventListener(e,v)}),v=r()(O,1e3*S,{trailing:!1,leading:!0}),y.forEach(e=>{document.addEventListener(e,v)});let x=()=>{N&&clearTimeout(N),E&&clearTimeout(E),!U()||document.hasFocus()||g.eD||null==I||I.dispatch(_.ES(h.eN));let a=parseInt(localStorage.getItem(b))+t-G();E=setTimeout(()=>{p.N.getIdleTimeoutPrecheck({fuid:e.id}).then(e=>{let a=e.data.meta.idle_timeout_last_active_at;a&&a+t>=G()?L(a):C()}).catch(e=>{C()})},1e3*a),F||(N=setTimeout(()=>{U()||null==I||I.dispatch(_.to({type:h.eN,data:{orgName:i,duration:t,onHide:()=>{O()}}}))},1e3*(a-M)))};k.register(P,()=>{x()}),x(),T=!0}(t,a,i,A,null==I?void 0:I.type,e)}},785:(e,t,a)=>{let i;a.d(t,{qr:()=>n});var r=((i=r||{}).MINUTES="minutes",i.HOURS="hours",i.DAYS="days",i);function n(e){return e<3600?[e/60,"minutes"]:e<86400?[e/3600,"hours"]:e%86400==0?[e/86400,"days"]:[e/3600,"hours"]}}}]);

//# debugId=489103e5-1a9f-5bba-8264-82af2f6e468c

//# sourceMappingURL=https://admin.figma.com/admin/webpack-artifacts/59939ea12b1f9988e21b65953b30f9991e46adcc/945-d969e82813569667.min.js.map